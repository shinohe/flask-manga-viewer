{% extends "base_layout.html" %}
{% block content %}

<style >
h2.ui-bar{
	font-size: 13px;
	margin: 0.5em 0;
}
.listThumbnail{
	width:100px;
	height:145px;
}
div.indexContent, div.indexContent div {
	min-height: auto;
}

div.sumbnail div.ui-bar {
	font-size: 13px !important;
	padding: 0.3em 0.5em;
}

div.sumbnail div.ui-bar .ui-btn {
	margin: 0 auto;
}

.listTitle {
	font-weight: 400;
	font-size: x-small;
	white-space: normal;
	overflow: hidden;
	text-align: center;
	height:3em;
}
.listGenre {
	font-weight: 400;
	font-size: xx-small;
	max-height: 1em;
}

.listShowDate {
	font-weight: 400;
	font-size: xx-small;
}

.pageArea {
	margin-top: 10px;

}

#pageBack,#pageNext{
	height:80px;
	line-height: 80px;
	font-size: 21px;
}

</style>
<script type="text/javascript">
var page = 1;
var searchFlag = false;

var successCallBack = function(msg){
	$(".indexContent").children("h2.ui-bar").remove();
	$(".indexContent").children("fieldset.ui-grid-a").remove();
	$(".indexContent").children("fieldset.ui-grid-solo").remove();

	var thumNailList = JSON.parse(msg.list);
	$.each(thumNailList, function( index, file){
		var $div = $("<div class='ui-bar'><span href='' class='ui-btn ui-btn-corner-all ui-shadow ui-btn-hover-c ui-btn-up-c' data-theme='c' style='width:100%'><span class='ui-btn-inner ui-btn-corner-all'><span class='ui-btn-text'><div><a href='/Viewer?page=" + file.folderName + "' class='ui-link'><div align='center' style='width:100%'><div class='listTmnArea'><img class='listThumbnail' src='/" + file.thumbnailPath + "' alt=''></div></div></a><div class='listTitle'><strong>" + file.name + "</strong></div><div class='listGenre'>" + file.category + "</div><span class='listShowDate'>" + file.updateDate + "</span></div></span></span></span></div>");
		var $divBlock;
		var $fieldset;
		if ( index%2 == 0) {
			$fieldset = $("<fieldset class='ui-grid-a'></fieldset>")
			$divBlock = $("<div class='sumbnail ui-block-a'></div>");
		} else {
			$fieldset = $(".indexContent fieldset:last");
			$divBlock = $("<div class='sumbnail ui-block-b'></div>");
		}
		$div.click(function(){
			var $link = $(this).find("a.ui-link");
			console.log("click "+$link.attr("href"));
			window.location.href = $link.attr("href");
		});
		
		$divBlock.append($div);
		
		$fieldset.append($divBlock);
		$(".indexContent").append($fieldset);
		
		$fieldset.ready(hideLoading());
	});
	if (thumNailList.length < 1) {
		hideLoading();
		$fieldset = $("<fieldset class='ui-grid-solo'><div class='ui-block-a noData'>対象のデータがありません。</div></fieldset>");
		$(".indexContent").append($fieldset);
	}
	
	if (page >= msg.maxSize) {
		$("#pageNext").hide();
	}  else {
		$("#pageNext").show();
	}
	 if(page == 1) {
		$("#pageBack").hide();
	} else {
		$("#pageBack").show();
	}
};

var latestList = function(){
	showLoading();
	$.ajax({
		type: "POST",
		url: "/Latest/list",
		contentType: "application/json",
		data:'{"page":' + page + ', "pageSize":8}',
		dataType: "json",
		success: function(msg){
			successCallBack(msg);
			$h2 = $('<h2 class="ui-bar ui-bar-b">新着 - ' + page + 'ページ</h2>');
			$(".searchArea").after($h2);
		}
	});
};

var searchList = function(){
	showLoading();
	$.ajax({
		type: "POST",
		url: "/Search/list",
		contentType: "application/json",
		data:'{"page":' + page + ',"searchText":"'+$("#searchText").val()+'", "pageSize":8}',
		dataType: "json",
		success: function(msg){
			successCallBack(msg);
			$h2 = $('<h2 class="ui-bar ui-bar-b">検索 - ' + page + 'ページ</h2>');
			$(".searchArea").after($h2);
		}
	});
};

var pageChange = function(){
	if (searchFlag) {
		searchList();
	} else {
		latestList();
	}
};

var onKeyEvent = function(code)
{
	//エンターキー押下なら
	if(13 === code)
	{
		$("#searchButton").click();
	}
}

function initializeContents(){
	latestList();
	
	$("#searchButton").click(function(){
		showLoading();
		searchList();
		searchFlag = true;
	});
	
	$("#pageBack").click(function(){
		page = page -1;
		if (page < 1) {
			page = 1;
		}
		pageChange();
	});
	$("#pageNext").click(function(){
		page = page +1;
		pageChange();
	});
	var observer = new MutationObserver(function (MutationRecords, MutationObserver) {
		$("#NnVD").css("z-index",0);
	});
	$("#NnVD").ready(function(){
		$("#NnVD").css("z-index",0);
	});
}
</script>

<div id="headerArea" data-role="page">
	<div style="z-index:0"><!--shinobi1--><script type="text/javascript" src="//xa.shinobi.jp/ufo/185533400"></script><noscript><a href="//xa.shinobi.jp/bin/gg?185533400" target="_blank"><img src="//xa.shinobi.jp/bin/ll?185533400" border="0"></a><br><span style="font-size:9px"><img style="margin:0;vertical-align:text-bottom;" src="//img.shinobi.jp/tadaima/fj.gif" width="19" height="11"> </span></noscript><!--shinobi2--></div>
	<div data-role="header"><h1>同人Webビューア</h1></div>
	<!-- admax
	<div class="admax-native" data-admax-id="aa4aa59078f014a2bd233373683881bd"></div>
	 -->
	<script src='http://fam-ad.com/ad/js/fam-tagify.min.js'></script>
	<div id= 'div_fam_async_149063_100'>
	<script language='javascript'><!--
	fam_js_async('http://fam-ad.com/ad', '_site=46951&_loc=149063&_mstype=100&_width=320&_height=320');
	//--></script>
	</div>
	<!-- admax -->
	<!-- admax -->
	<div style="text-align:center;padding:0.5em;">
		<script src="//adm.shinobi.jp/s/c383de425a21f7a6f1c572bba1f8edbb"></script>
	</div>
	<!-- admax -->
	<div data-role="content">
		<div class="form">
			<div class="container indexContent">
				<div class="searchArea">
					<input type="text" id="searchText" placeholder="タイトル等" onkeypress="onKeyEvent(event.keyCode);"/>
					<input type="button" id="searchButton" value="検索"/>
					<!-- admax -->
					<div style="text-align:center;padding:0.5em;">
						<script src="//adm.shinobi.jp/s/fa8ed5cb07209e6c47a34df52c3ef998"></script>
					</div>
					<!-- admax -->
				</div>
			</div>
			<div class="pageArea">
				<!-- admax
				<div class="admax-native" data-admax-id="34c8fec58be5acec4bdc029549823799"></div>
				 -->
				<script src='http://fam-ad.com/ad/js/fam-tagify.min.js'></script>
				<div id= 'div_fam_async_149057_100'>
				<script language='javascript'><!--
				fam_js_async('http://fam-ad.com/ad', '_site=46951&_loc=149057&_mstype=100&_width=375&_height=375');
				//--></script>
				</div>


				<fieldset class="ui-grid-a">
					<div class="sumbnail back ui-block-a ui-btn ui-btn-corner-all ui-shadow ui-btn-hover-c ui-btn-up-c" id="pageBack">戻る</div>
					<div class="sumbnail next ui-block-b ui-btn ui-btn-corner-all ui-shadow ui-btn-hover-c ui-btn-up-c" id="pageNext">次へ</div>
				</fieldset>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript" charset="utf-8" src="//adm.shinobi.jp/st/na.js"></script>


{% endblock %}
